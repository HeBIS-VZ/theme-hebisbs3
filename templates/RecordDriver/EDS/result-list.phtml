<?
  $this->headLink()->appendStylesheet('EDS.css');
  $accessLevel = $this->driver->getAccessLevel();
  $restrictedView = empty($accessLevel) ? false : true;
  $coverDetails = $this->record($this->driver)->getCoverDetails('result-list', 'medium', $this->recordLink()->getUrl($this->driver));
?>
<?
  $thumbnail = false;
  $thumbnailAlignment = $this->record($this->driver)->getThumbnailAlignment('result'); ?>
  <?
  ob_start(); ?>
  <div class="media-<?=$thumbnailAlignment ?> <?=$this->escapeHtml($coverDetails['size'])?>">
    <? if ($coverDetails['cover']): ?>
      <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="_record_link">
        <img src="<?=$this->escapeHtmlAttr($coverDetails['cover'])?>" class="recordcover" alt="<?=$this->transEsc('Cover Image')?>"/>
      </a>
    <? else: ?>
      <span class="recordcover pt-icon pt-<?=$this->driver->getPubTypeId()?>"></span>
      <div><?=$this->driver->getPubType()?></div>
    <? endif; ?>
  </div>

<? $thumbnail = ob_get_contents(); ?>
<? ob_end_clean(); ?>
<input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getUniqueID())?>" class="hiddenId" />
<input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getSourceIdentifier())?>" class="hiddenSource" />

<div class="row result-list-item">
    <div class="hidden-xs col-md-2 text-center title-thumb">
        <div class="sr-only"><?= $this->driver->getFields()['ResultId']; ?></div>
        <? if ($thumbnail) : ?>
            <?=$thumbnail ?>
        <? endif; ?>
    </div>
    <div class="col-md-7 title">
        <? $items = $this->driver->getItems();
           $recordInfo = $this->driver->getFields()['RecordInfo'];
           $title = ""; ?>


        <? if (isset($items) && !empty($items)): ?>
            <? $authors = $this->edsAuthorsResultList($this->driver); ?>
            <? $subjects = $this->edsSubjectResultList($this->driver); ?>
            <?foreach ($items as $item):
                if (!empty($item)): ?>
                    <?if (!in_array($item['Group'], ['Ti', 'Src'])) :
                        continue;
                    elseif('Ti' == $item['Group']): ?>
                        <? $title = '<a href="'.$this->recordLink()->getUrl($this->driver).'" class="title getFull _record_link"  data-view="'.$this->params->getOptions()->getListViewOption().'">'.$item['Data'].'</a>'; ?>
                    <? elseif ('Src' == $item['Group']):?>
                        <? $titleSource = $this->driver->linkUrls($item['Data']); ?>
                    <? endif;?>
                <? endif;
            endforeach; ?>
            <div class="resultItemLine1">
                <p>
                    <?=$title?>
                    <?= !empty($authors) ? "<br />" . $authors : ""?>
                    <?= !empty($titleSource) ? "<br />" . $titleSource : ""?>
                    <?= !empty($subjects) ? "<br />" . $subjects : ""?>
                </p>
                <? $customLinks = array_merge($this->driver->getFTCustomLinks(), $this->driver->getCustomLinks()); ?>
                <? if ($this->driver->hasHTMLFullTextAvailable() || $this->driver->hasPdfAvailable() || !empty($customLinks)): ?>
                    <p>
                        <? if ($this->driver->hasHTMLFullTextAvailable()): ?>
                            <a href="<?=$this->recordLink()->getUrl($this->driver, 'fulltext')?>#collapseFulltext" class="icon html fulltext _record_link">
                                <?=$this->transEsc('HTML Full Text')?>
                            </a>
                        <? endif; ?>
                        <? if ($this->driver->hasPdfAvailable()): ?>
                            <a href="<?= $this->recordLink()->getUrl($this->driver).'/PDF'; ?>" class="icon pdf fulltext" target="_blank">
                                <?=$this->transEsc('PDF Full Text')?>
                            </a>
                        <? endif; ?>
                        <?
                        if (!empty($customLinks)): ?>
                            <? foreach ($customLinks as $customLink): ?>
                                <? $url = isset($customLink['Url']) ? $customLink['Url'] : '';
                                $mot = isset($customLink['MouseOverText'])? $customLink['MouseOverText'] : '';
                                $icon = isset ($customLink['Icon']) ? $customLink['Icon'] : '';
                                $name = isset($customLink['Text']) ? $customLink['Text'] : '';
                                ?>
                            <span>
                                <a href="<?=$this->escapeHtmlAttr($url)?>" target="_blank" title="<?=$this->escapeHtmlAttr($mot)?>" class="custom-link">
                                    <? if ($icon): ?><img src="<?=$this->escapeHtmlAttr($icon)?>" /> <? endif; ?><?=$this->escapeHtml($name)?>
                                </a>
                            </span>
                            <? endforeach; ?>
                        <? endif; ?>
                    </p>
                <? endif; ?>
            </div>
        <? elseif ($restrictedView): ?>
            <div class="resultItemLine1">
                <p>
                    <?=$this->transEsc('This result is not displayed to guests')?>
                    <br />
                    <a class="login" href="<?=$this->url('myresearch-home')?>">
                        <strong><?=$this->transEsc('Login for full access')?></strong>
                    </a>
                </p>
            </div>
        <? endif; ?>

    </div>
    <div class="col-sm-3 hidden-print">
        <? if ($this->userlist()->getMode() !== 'disabled'): ?>
            <? /* Add to favorites */ ?>
            <span class="hds-icon-star-empty" aria-hidden="true"><!-- --></span> <a href="<?=$this->recordLink()->getActionUrl($this->driver, 'Save')?>" class="save-record" data-lightbox id="<?=$this->driver->getUniqueId() ?>" title="<?=$this->transEsc('Add to favorites')?>"><?=$this->transEsc('Add to favorites')?></a><br/>

            <? /* Saved lists */ ?>
            <div class="savedLists alert alert-info hidden">
                <strong><?=$this->transEsc("Saved in")?>:</strong>
            </div>
        <? endif; ?>
    </div>
</div>