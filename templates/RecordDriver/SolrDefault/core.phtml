<?
if ($loggedin = $this->auth()->isLoggedIn()) {
    $user_id = $loggedin->id;
    $loggedin = true;
} else {
    $user_id = false;
}
?>

<div class="row">

    <div class="col-md-9<?// $this->layoutClass('mainbody') ?>">

        <? $format = $this->physicalDescriptionFormat($this->driver);//$this->driver->getFormats(); if (!empty($formats)): ?>
        <div vocab="http://schema.org/" resource="#record" typeof="<?= $this->driver->getSchemaOrgFormats() ?> Product">

            <div class="row">
                <div class="col-sm-3 hidden-xs">
                    <? if (isset($this->scrollData) && ($this->scrollData['previousRecord'] || $this->scrollData['nextRecord'])): ?>
                        <ul class="pager hidden-print hidden-xs hidden-sm">
                            <? if ($this->scrollData['previousRecord']): ?>
                                <li>
                                    <a href="<?= $this->recordLink()->getUrl($this->scrollData['previousRecord']) ?>"
                                       title="<?= $this->transEsc('Previous Search Result') ?>"><span class="hds-icon-left-open"><!-- --> </span><span class="sr-only"><?= $this->transEsc('Prev') ?></span></a>
                                </li>
                            <? else: ?>
                                <li class="disabled"><span class="hds-icon-left-open"><!-- --> </span><span class="sr-only"><?= $this->transEsc('Prev') ?></span></li>
                            <? endif; ?>
                            <li><span><?= $this->localizedNumber($this->scrollData['currentPosition']) . ' / ' . $this->localizedNumber($this->scrollData['resultTotal']) //' ' . $this->transEsc('results') ?></span></li>
                            <? if ($this->scrollData['nextRecord']): ?>
                                <li>
                                    <a href="<?= $this->recordLink()->getUrl($this->scrollData['nextRecord']) ?>"
                                       title="<?= $this->transEsc('Next Search Result') ?>"><span class="sr-only"><?= $this->transEsc('Next') ?></span><span class="hds-icon-right-open"> <!-- --></span></a>
                                </li>
                            <? else: ?>
                                <li class="disabled"><span class="sr-only"><?= $this->transEsc('Next') ?></span><span class="hds-icon-right-open"> <!-- --></span></li>
                            <? endif; ?>
                        </ul>
                    <? endif; ?>
                    <div class="text-center">
                        <? $cached = $this->record($this->driver)->hasThumbnailCachedFile('medium'); ?>

                        <? /* Display thumbnail if appropriate: */ ?>
                        <? $mediumThumb = $this->record($this->driver)->getThumbnail('medium');
                        $largeThumb = $this->record($this->driver)->getThumbnail('large'); ?>
                        <? if ($mediumThumb): ?>
                            <? if ($largeThumb): ?><a href="<?= $this->escapeHtmlAttr($largeThumb) ?>"><? endif; ?>
                            <img alt="<?= $this->transEsc('Cover Image') ?>" class="img-thumbnail img-responsive"
                                 src="<?= $this->escapeHtmlAttr($mediumThumb); ?>"/>
                            <? if ($largeThumb): ?></a><? endif; ?>
                        <? else: ?>
                            <img src="<?= $this->url('cover-unavailable') ?>" class="img-responsive"
                                 alt="<?= $this->transEsc('No Cover Image') ?>"/>
                        <? endif; ?>
                    </div>
                </div>
                <div class="col-sm-9">
                    <h3 property="name">
                        <? //$this->escapeHtml($this->driver->getShortTitle() . ' ' . $this->driver->getSubtitle() . ' ' . $this->driver->getTitleSection())?>
                        <span class="hds-icon-<?= $format ?>"></span>
                        <?= $this->escapeHtml($this->singleRecordTitleStatementHeadline($this->driver)) ?>
                    </h3>

                    <? $summary = $this->driver->getSummary();
                    $summary = isset($summary[0]) ? $this->escapeHtml($summary[0]) : false; ?>
                    <? if ($summary): ?>
                        <p><?= $this->truncate($summary, 300) ?></p>

                        <? if (strlen($summary) > 300): ?>
                            <p>
                                <a href='<?= $this->recordLink()->getTabUrl($this->driver, 'Description') ?>#tabnav'><?= $this->transEsc('Full description') ?></a>
                            </p>
                        <? endif; ?>
                    <? endif; ?>

                    <? if ($this->userlist()->getMode() !== 'disabled'): ?>
                        <? /* Display the lists that this record is saved to */ ?>
                        <div class="savedLists hidden alert alert-info" id="savedLists">
                            <strong><?= $this->transEsc("Saved in") ?>:</strong>
                        </div>
                    <? endif; ?>

                    <? /* Display Main Details */ ?>
                    <div class="record-details">

                        <!-- Titel -->
                        <? $title = $this->singleRecordTitleStatement($this->driver); ?>
                        <? $owtitle = $this->singleRecordOWTitleStatement($this->driver); //get the ow title from view helper ?>
                        <div class="row">
                            <div class="bold col-sm-12 col-md-3 col-lg-2">
                                <?= $this->transEsc('Title') ?>:
                            </div>
                            <div class="col-sm-12 col-md-9 col-lg-10">
                                <? if ($owtitle) : ?><?= $owtitle ?><br/><? endif; ?>
                                <?= $title ?>
                            </div>
                        </div>

                        <!-- Unterreihe -->
                        <? $sectionOfWork = $this->singleRecordSectionOfAWork($this->driver); ?>
                        <? if ($sectionOfWork) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Section of a work'); ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $sectionOfWork ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Teil -->
                        <? $partOfWork = $this->singleRecordPartOfAWork($this->driver); ?>
                        <? if ($partOfWork) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Part of a work'); ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $partOfWork ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Verantwortlich -->
                        <? $authors = $this->singleRecordPersonalName($this->driver, false); ?>
                        <? $owauthors = $this->singleRecordOWPersonalName($this->driver, false); ?>
                        <? if (!empty($authors)) : ?>
                            <div class="row">
                                <div
                                    class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Author/editor-in-chief') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10" property="author">
                                    <? if (!empty($owauthors)) : ?><?= $owauthors ?><br/><? endif; ?>
                                    <?= $authors ?>
                                </div>
                            </div>
                        <? endif; ?>

                        <!-- Körperschaft -->
                        <? $corporate = $this->singleRecordCorporateName($this->driver); ?>
                        <? if (!empty($corporate)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Corporate') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10" property="author"><?= $corporate ?></div>
                            </div>
                        <? endif; ?>


                        <? $hostItem = $this->singleRecordHostItemEntry($this->driver); ?>
                        <? if (!empty($hostItem)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Published in') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10">
                                    <?= $this->singleRecordHostItemEntry($this->driver); ?>
                                </div>
                            </div>
                        <? endif; ?>

                        <? $datesOfPublication = $this->singleRecordDatesOfPublicationSequentialDesignation($this->driver); ?>
                        <? if (!empty($datesOfPublication)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Dates of publication/Sequential designation'); ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $datesOfPublication ?></div>
                            </div>
                        <? endif; ?>


                        <!-- Published in
                    <? //$marcJournal = $this->singleRecordMarcJournal($this->driver); ?>
                    <? if ($marcJournal) : ?>
                        <div class="row">
                            <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('Marc Journal') ?>:</div>
                            <div class="col-sm-12 col-md-9 col-lg-10"><?= $marcJournal ?></div>
                        </div>
                    <? endif; ?>
                    -->

                        <!-- Manufacture / Entstehung-->
                        <? $manufacture = $this->singleRecordManufacture($this->driver); ?>
                        <? if (!empty($manufacture)) : ?>
                            <div class="row">
                                <div
                                    class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Manufacture'); ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $manufacture ?></div>
                            </div>
                        <? endif; ?>


                        <!-- Publication / Veröffentlicht -->
                        <? $publicationDistribution = $this->singleRecordPublication($this->driver); ?>
                        <? $publicationOWDistribution = $this->singleRecordOWPublication($this->driver); ?>
                        <? if (!empty($publicationDistribution)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Publication') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10">
                                    <? if (!empty($publicationOWDistribution)) : ?>
                                        <?= $publicationOWDistribution ?><br/>
                                    <? endif; ?>
                                    <?= $publicationDistribution ?>
                                </div>
                            </div>
                        <? endif; ?>

                        <!-- Production / Herstellung -->
                        <? $production = $this->singleRecordProduction($this->driver); ?>
                        <? if (!empty($production)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Production') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $production ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Distribution / Vertrieb -->
                        <? $distribution = $this->singleRecordDistribution($this->driver); ?>
                        <? if (!empty($distribution)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Distribution') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $distribution ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Einheitssachtitel -->
                        <? $uniformTitle = $this->singleRecordUniformTitle($this->driver); ?>
                        <? if (!empty($uniformTitle)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Uniform title') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $uniformTitle ?></div>
                            </div>
                        <? endif; ?>

                        <!-- auch als -->
                        <? $additionalPhysical = $this->singleRecordAdditionalPhysicalFromAvailableNote($this->driver); ?>
                        <? if (!empty($additionalPhysical)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('Additional physical from available note') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $additionalPhysical ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Reproduction note / Vorliegende Ausgabe -->
                        <? $reproduction = $this->singleRecordReproductionNote($this->driver); ?>
                        <? if (!empty($reproduction)) : ?>
                            <div class="row">
                                <div
                                    class="bold col-sm-12 col-md-3 col-lg-2" property="bookEdition"><?= $this->transEsc('Reproduction note') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $reproduction ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Hochschulschrift -->
                        <? $dissertationNote = $this->singleRecordDissertationNote($this->driver) ?>
                        <? if (!empty($dissertationNote)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Dissertation note') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $dissertationNote ?></div>
                            </div>
                        <? endif; ?>

                        <? $nextTitles = $this->driver->getNewerTitles();
                        $prevTitles = $this->driver->getPreviousTitles(); ?>
                        <? if (!empty($nextTitles)): ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('New Title') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10">
                                    <? foreach ($nextTitles as $field): ?>
                                        <a href="<?= $this->record($this->driver)->getLink('title', $field) ?>"><?= $this->escapeHtml($field) ?></a>
                                        <br/>
                                    <? endforeach; ?>
                                </div>
                            </div>
                        <? endif; ?>

                        <? if (!empty($prevTitles)): ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Previous Title') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10">
                                    <? foreach ($prevTitles as $field): ?>
                                        <a href="<?= $this->record($this->driver)->getLink('title', $field) ?>"><?= $this->escapeHtml($field) ?></a>
                                        <br/>
                                    <? endforeach; ?>
                                </div>
                            </div>
                        <? endif; ?>

                        <!-- Other Edition Entry-->
                        <? $otherEditionEntry = $this->singleRecordOtherEditionEntry($this->driver); ?>
                        <? if (!empty($otherEditionEntry)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Other edition entry') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $otherEditionEntry ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Ausgabe
                        <? $edition = $this->driver->getEdition();
                        if (!empty($edition)): ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('Edition') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10"
                                     property="bookEdition"><?= $this->escapeHtml($edition) ?></div>
                            </div>
                        <? endif; ?>
                        -->
                        <!-- Title Contains -->
                        <? $titleContains = $this->singleRecordTitleContains($this->driver); ?>
                        <? if (!empty($titleContains)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Title contains'); ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $titleContains ?></div>
                            </div>
                        <? endif; ?>

                        <!-- ISBN -->
                        <? $isbn = $this->singleRecordInternationalStandardBookNumber($this->driver); ?>
                        <? if (!empty($isbn)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('ISBN') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $isbn ?></div>
                            </div>
                        <? endif; ?>

                        <!-- ISSN -->
                        <? $issn = $this->singleRecordInternationalStandardSerialNumber($this->driver); ?>
                        <? if (!empty($issn)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('ISSN') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $issn ?></div>
                            </div>
                        <? endif; ?>

                        <!-- ISMN -->
                        <? $ismn = $this->singleRecordInternationalStandardMusicNumber($this->driver); ?>
                        <? if (!empty($ismn)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('ISMN') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $ismn ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Physical Description / Umfang -->
                        <? $physicalDescription = $this->singleRecordPhysicalDescription($this->driver); ?>
                        <? if (!empty($physicalDescription)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Physical description scale') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $physicalDescription ?></div>
                            </div>
                        <? endif; ?>

                        <? if (!empty($format)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('Format') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><span
                                        class="label label-info hds-icon-<?= $format ?>">
                                    <?= $this->transEsc($format); ?>
                                </span></div>
                            </div>
                        <? endif; ?>

                        <? $langs = $this->driver->getLanguages();
                        if (!empty($langs)): ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('Language') ?>:</div>
                                <div
                                    class="col-sm-12 col-md-9 col-lg-10"><? foreach ($langs as $lang): ?><?= $this->transEsc($lang) ?>
                                        <br/><? endforeach; ?></div>
                            </div>
                        <? endif; ?>

                        <!-- RVK -->
                        <? $rvk = $this->singleRecordOtherClassificationNumber($this->driver, true) ?>
                        <? if (!empty($rvk)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('RVK-Notation'); ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10">
                                    <script type="text/javascript">
                                        //<![[
                                        /* in order to keep an eye on performance, the popup javascript just will be used when required
                                         */
                                        $(function () {
                                            var baseUrl = "https://resolver.hebis.de/rvkffm/";

                                            $('.rvk-info .label').hover(function (e) {
                                                var $popup = $(this);
                                                $popup.off('hover');
                                                var id = $popup.data('id');
                                                var parts = id.split(' ');
                                                var url = baseUrl + parts[0] + '/' + parts[1];
                                                $.get(url, function (d) {
                                                    var str = eval(d + "RVK;");
                                                    $popup.popover({
                                                        content: "<small>" + str.replaceAll("/", " / ") + "</small>",
                                                        html: true
                                                    }).popover('toggle');
                                                });
                                            });
                                        });
                                        //]]>
                                    </script>
                                    <? foreach ($rvk as $r) : ?>
                                        <span class="rvk-info"><a class="rvk-link"
                                                                  href="<?= $this->basePath() ?>/Search/Results?lookfor=rvk_full%3A%22<?= $this->transEsc($r) ?>%22&type=allfields"><?= $this->transEsc($r) ?></a>&nbsp;<span
                                                style="padding-bottom: 1px; font-size: 80%; font-weight: lighter; cursor: pointer"
                                                data-toggle="popover" data-id="<?= $r ?>" data-container="body"
                                                data-placement="auto"
                                                class="label label-info">rvk</span></span>&nbsp;&nbsp;
                                    <? endforeach; ?>
                                </div>
                            </div>
                        <? endif; ?>


                        <!-- Schlagworte -->
                        <? $keywords = $this->singleRecordSubjectAccessFieldsGeneralInformation($this->driver) ?>
                        <? if (!empty($keywords)) : ?>
                            <div class="row">
                                <div
                                    class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('Subject Added Keywords'); ?></div>
                                <div class="col-sm-12 col-md-9 col-lg-10">
                                    <div class="keywords">
                                        <form method="get" action="<?= $this->basePath() ?>/Search/Results"
                                              id="searchForm" name="searchForm" class="search">
                                            <input type="hidden" name="bool0[]" value="AND"/>
                                            <?= str_replace("<br />", " ", $keywords); ?>
                                            <button type="submit" class="btn btn-default btn-xs">
                                                <span class="hds-icon-search"></span>
                                            </button>
                                        </form>
                                    </div>
                                </div>

                            </div>
                        <? endif; ?>

                        <!-- Preceding Entry / Succeeding Entry -->
                        <? $precedingSucceeding = $this->singleRecordPrecedingSucceedingEntry($this->driver); ?>
                        <? if (!empty($precedingSucceeding)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2">
                                    <?= $this->transEsc('Preceding entry/Succeeding entry') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $precedingSucceeding ?></div>
                            </div>
                        <? endif; ?>

                        <? /* Display series section if at least one series exists. */ ?>
                        <? $series = $this->singleRecordSeriesStatementAddedEntry($this->driver); ?>
                        <? if (!empty($series)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('Series') ?>:</div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $series ?></div>
                            </div>
                        <? endif; ?>

                        <!-- Zielgruppe -->
                        <? $targetAudience = $this->singleRecordTargetAudienceNote($this->driver); ?>
                        <? if (!empty($targetAudience)) : ?>
                            <div class="row">
                                <div class="bold col-sm-12 col-md-3 col-lg-2"><?= $this->transEsc('Zielgruppe') ?>:
                                </div>
                                <div class="col-sm-12 col-md-9 col-lg-10"><?= $targetAudience ?></div>
                            </div>
                        <? endif; ?>
                    </div> <!-- /.record-details -->
                    <table>

                        <? $childRecordCount = $this->driver->tryMethod('getChildRecordCount');
                        if ($childRecordCount): ?>
                            <tr>
                                <th><?= $this->transEsc('child_records') ?>:</th>
                                <td>
                                    <a href="<?= $this->recordLink()->getChildRecordSearchUrl($this->driver) ?>"><?= $this->transEsc('child_record_count', array('%%count%%' => $childRecordCount)) ?></a>
                                </td>
                            </tr>
                        <? endif; ?>


                        <?
                        //$openUrl = $this->driver->openURLActive('record') ? $this->driver->getOpenURL() : false;
                        // Account for replace_other_urls setting
                        $urls = $this->record($this->driver)->getLinkDetails();
                        ?>
                        <? if (!empty($urls)): ?>
                            <tr>
                                <th><?= $this->transEsc('Online Access') ?>:</th>
                                <td>
                                    <? foreach ($urls as $current): ?>
                                        <a href="<?= $this->escapeHtmlAttr($this->proxyUrl($current['url'])) ?>"><?= $this->escapeHtml($current['desc']) ?></a>
                                        <br/>
                                    <? endforeach; ?>
                                </td>
                            </tr>
                        <? endif; ?>

                        <? $recordLinks = $this->driver->getAllRecordLinks(); ?>
                        <? if (!empty($recordLinks)): ?>
                            <tr>
                                <th><?= $this->transEsc('Related Items') ?>:</th>
                                <td>
                                    <? foreach ($recordLinks as $recordLink): ?>
                                        <?= $this->transEsc($recordLink['title']) ?>:
                                        <a href="<?= $this->recordLink()->related($recordLink['link']) ?>"><?= $this->escapeHtml($recordLink['value']) ?></a>
                                        <br/>
                                    <? endforeach; ?>
                                    <? /* if we have record links, display relevant explanatory notes */
                                    $related = $this->driver->getRelationshipNotes();
                                    if (!empty($related)): ?>
                                        <? foreach ($related as $field): ?>
                                            <?= $this->escapeHtml($field) ?><br/>
                                        <? endforeach; ?>
                                    <? endif; ?>

                                    <?= $this->bibTip($this->driver); ?>
                                </td>
                            </tr>
                        <? endif; ?>

                        <? if ($this->usertags()->getMode() !== 'disabled'): ?>
                            <? $tagList = $this->driver->getTags(); ?>
                            <tr>
                                <th><?= $this->transEsc('Tags') ?>:</th>
                                <td>
                                    <a class="tag-record btn btn-link pull-right flip"
                                       href="<?= $this->recordLink()->getActionUrl($this->driver, 'AddTag') ?>"
                                       data-lightbox>
                                        <i class="fa fa-plus"></i> <?= $this->transEsc('Add Tag') ?>
                                    </a>
                                    <!--
                                    <span class="pull-right">
                                        <i class="fa fa-plus"></i> <a id="tagRecord" class="modal-link" href="<?= $this->recordLink()->getActionUrl($this->driver, 'AddTag') ?>" title="<?= $this->transEsc('Add Tag') ?>"><?= $this->transEsc('Add Tag') ?></a>
                                    </span>
                                -->
                                    <?= $this->context($this)->renderInContext('record/tagcloud', array('tagList' => $tagList, 'loggedin' => $loggedin)) ?>
                                    <!--
                                <div id="tagList">
                                    <? if (count($tagList) > 0): ?>
                                        <? $i = 0;
                                        foreach ($tagList as $tag): ?><?= ($i++ == 0) ? '' : ', ' ?><a href="<?= $this->url('tag-home') ?>?lookfor=<?= urlencode($tag->tag) ?>"><?= $this->escapeHtml($tag->tag) ?></a> (<?= $this->escapeHtml($tag->cnt) ?>)<? endforeach; ?>
                                    <? else: ?>
                                        <?= $this->transEsc('No Tags') ?>, <?= $this->transEsc('Be the first to tag this record') ?>!
                                    <? endif; ?>
                                </div>
                                -->
                                </td>
                            </tr>
                        <? endif; ?>
                    </table>
                    <? /* End Main Details */ ?>
                </div>
            </div>
        </div>

        <div class="tab-description">
            <? if (count($this->tabs) > 0): ?>
                <a name="tabnav"></a>
                <ul class="recordTabs nav nav-tabs nav-justified">
                    <?
                    /** @var \Hebis\RecordTab\TabInterface $obj */
                    foreach ($this->tabs as $tab => $obj): ?>
                        <? // add current tab to breadcrumbs if applicable:
                        $desc = $obj->getDescription();
                        $hasContents = $obj->hasContents();
                        $tab_classes = array();
                        if (0 === strcasecmp($this->activeTab, $tab)) {
                            $tab_classes[] = 'active';
                            $breadcrumbs = $this->layout()->breadcrumbs .= '<li class="active">' . $this->transEsc($desc) . '</li>';
                            $activeTabObj = $obj;
                        }
                        if (!$obj->isVisible()) {
                            $tab_classes[] = 'hidden';
                        }
                        if (!$obj->supportsAjax()) {
                            $tab_classes[] = 'noajax';
                        }
                        if (!$hasContents) {
                            $tab_classes[] = 'disabled';
                        }
                        ?>
                        <li<?= count($tab_classes) > 0 ? ' class="' . implode(' ', $tab_classes) . '"' : '' ?>>
                            <? if ($hasContents) : ?>
                            <a id="<?= strtolower($tab) ?>"
                               href="<?= $this->recordLink()->getTabUrl($this->driver, $tab) ?>#tabnav"><?= $this->transEsc($desc) ?></a>
                            <? else : ?>
                                <a id="<?= strtolower($tab) ?>" href="#tabnav"><?= $this->transEsc($desc) ?></a>
                            <? endif; ?>
                        </li>
                    <? endforeach; ?>
                </ul>
            <? endif; ?>

            <div class="tab-content" id="record-tabs">
                <div class="tab-pane active" id="<?= $this->activeTab ?>-tab">
                    <?= isset($activeTabObj) ? $this->record($this->driver)->getTab($activeTabObj) : '' ?>
                </div>
            </div>
        </div>

        <span class="Z3988" title="<?= $this->escapeHtmlAttr($this->driver->getOpenURL()) ?>"></span>
    </div>
    <div class="col-md-3<? //$this->layoutClass('sidebar') ?>">

        <div class="text-center">


            <? /* Display qrcode if appropriate: */ ?>
            <? $QRCode = $this->record($this->driver)->getQRCode("core"); ?>
            <? if ($QRCode): ?>
                <span class="hidden-xs">
                  <br/><img alt="<?= $this->transEsc('QR Code') ?>" class="qrcode"
                            src="<?= $this->escapeHtmlAttr($QRCode); ?>"/>
                </span>
            <? endif; ?>
        </div>

        <? // if you have a preview tab but want to move or remove the preview link
        // from this area of the record view, this can be split into
        // getPreviewData() (should stay here) and
        // getPreviewLink() (can go in your desired tab) ?>
        <?= $this->record($this->driver)->getPreviews() ?>
        <hr/>
        <?= $this->record($this->driver)->getToolbar() ?>
        <hr/>

        <? $isbns = $this->singleRecordInternationalStandardBookNumber($this->driver, true); ?>
        <? if (!empty($isbns)) : ?>
            <div id="other-editions" data-xid="<?=$isbns['0']?>">

            </div>
        <? endif;?>
        <?= $this->render('RecordDriver/SolrDefault/result-bibtip.phtml'); ?>
        <!--
        <? /*foreach ($this->related()->getList($this->driver) as $current): ?>
            <?= $this->related()->render($current) ?>
        <? endforeach; */?>
        -->
    </div>
</div>